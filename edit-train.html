<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>列車データ編集</title>
  <link rel="stylesheet" href="reset.css" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>列車データ編集</h1>
    <form id="edit-form">
      <div class="form-group">
        <label for="train-type">種別</label>
        <input type="text" id="train-type" name="trainType" required />
      </div>
      <div class="form-group">
        <label for="station">駅名</label>
        <input type="text" id="station" name="station" required />
      </div>
      <div class="form-group">
        <label for="time">時刻</label>
        <input type="time" id="time" name="time" required />
      </div>
      <div class="form-group">
        <label for="train">車両</label>
        <input type="text" id="train" name="train" required />
      </div>
      <div class="form-group">
        <label for="content">内容</label>
        <input type="text" id="content" name="content" required />
      </div>
      <div class="form-group">
        <label for="direction">方向</label>
        <select id="direction" name="direction">
          <option value="上り">上り</option>
          <option value="下り">下り</option>
        </select>
      </div>
      <button type="submit">保存</button>
    </form>
    <button id="cancel" onclick="window.history.back()">キャンセル</button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const index = urlParams.get("index");
      const type = urlParams.get("type"); // 新たに type パラメータを追加

      // localStorageから貨物列車・普通列車のデータを取得
      const timetable = JSON.parse(localStorage.getItem("timetable")) || [];
      const ordinaryTimetable = JSON.parse(localStorage.getItem("ordinaryTimetable")) || [];

      let trainData;

      // 編集する列車データの取得
      if (type === 'ordinary') {
        trainData = ordinaryTimetable[index];
      } else {
        trainData = timetable[index];
      }

      if (!trainData) {
        alert("指定された列車データが見つかりません。");
        return;
      }

      // フォームに既存のデータをセット
      const form = document.getElementById("edit-form");
      form.elements["trainType"].value = trainData.trainType || '';
      form.elements["station"].value = trainData.station || '';
      form.elements["time"].value = trainData.time || '';
      form.elements["train"].value = trainData.train || '';
      form.elements["content"].value = trainData.content || '';
      form.elements["direction"].value = trainData.direction || '上り';

      // フォームの送信処理
      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const updatedTrainData = {
          trainType: form.elements["trainType"].value,
          station: form.elements["station"].value,
          time: form.elements["time"].value,
          train: form.elements["train"].value,
          content: form.elements["content"].value,
          direction: form.elements["direction"].value,
        };

        // データを更新して保存
        if (type === 'ordinary') {
          ordinaryTimetable[index] = updatedTrainData;
          localStorage.setItem("ordinaryTimetable", JSON.stringify(ordinaryTimetable));
        } else {
          timetable[index] = updatedTrainData;
          localStorage.setItem("timetable", JSON.stringify(timetable));
        }

        // 保存後、元のページに戻る
        alert("列車データが更新されました。");
        window.location.href = "index.html"; // 元のページにリダイレクト
      });
    });
  </script>
</body>
</html>
